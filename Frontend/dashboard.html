!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Job Tracker - Dashboard</title>

    <link rel="stylesheet" href="style.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>

    <style>

        .status-badge { padding: 5px 10px; border-radius: 5px; font-weight: bold; font-size: 12px; text-transform: capitalize; }

        .status-badge.success { background: #27ae60; color: white; }

        .status-badge.pending { background: #f1c40f; color: #333; }

        .status-badge.fail { background: #e74c3c; color: white; }

        .status-badge.interview { background: #3498db; color: white; }

        .status-badge.applied { background: #9b59b6; color: white; }

        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2000; justify-content: center; align-items: center; }

        .content-section { display: none; padding: 20px; }

        #overview-section { display: block; }

        .nav-links li { cursor: pointer; }

        .nav-links li.active { background: rgba(255,255,255,0.1); border-left: 4px solid #fff; }

    </style>

</head>





<body class="dashboard-body">



    <nav class="sidebar">

        <div class="sidebar-header"><i class="fas fa-briefcase"></i><span>JobTracker</span></div>

        <ul class="nav-links">

            <li class="active" id="nav-overview" onclick="showSection('overview')"><a><i class="fas fa-th-large"></i> Overview</a></li>

            <li id="nav-tasks" onclick="showSection('tasks')"><a><i class="fas fa-list-check"></i> My Tasks</a></li>

            <li id="nav-analytics" onclick="showSection('analytics')"><a><i class="fas fa-chart-line"></i> Analytics</a></li>

            <li id="nav-profile" onclick="showSection('profile')"><a><i class="fas fa-user-circle"></i> Profile</a></li>

        </ul>

        <div class="sidebar-footer">

            <a href="#" onclick="handleLogout(event)" class="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</a>

        </div>

    </nav>



    <main class="main-content">

        <header class="top-bar">

            <div class="welcome-text">

                <h1>Hello, <span id="displayUserName">User</span> ??</h1>

            </div>

            <div class="header-actions">

                <button class="add-btn" style="background: #27ae60; margin-right: 10px;" onclick="exportToCSV()"><i class="fas fa-file-export"></i> Export CSV</button>

                <button class="add-btn" onclick="openModal()">+ Add New Job</button>

            </div>

        </header>



        <div id="overview-section" class="content-section">

            <section class="stats-grid">

                <div class="stat-card total"><i class="fas fa-paper-plane"></i><div class="info"><h3>Applied</h3><p id="totalCount" class="count">0</p></div></div>

                <div class="stat-card interview"><i class="fas fa-users"></i><div class="info"><h3>Interviews</h3><p id="interviewCount" class="count">0</p></div></div>

                <div class="stat-card success"><i class="fas fa-check-circle"></i><div class="info"><h3>Success</h3><p id="successCount" class="count">0</p></div></div>

            </section>

            

            <div style="display: flex; gap: 15px; margin: 20px 0; background: white; padding: 15px; border-radius: 10px;">

                <input type="text" id="searchInput" onkeyup="filterJobs()" placeholder="Search Company or Role..." style="flex: 2; padding: 10px; border-radius: 5px; border: 1px solid #ddd;">

                <select id="statusFilter" onchange="filterJobs()" style="flex: 1; padding: 10px; border-radius: 5px; border: 1px solid #ddd;">

                    <option value="All">All Status</option>

                    <option value="Applied">Applied</option>

                    <option value="Interview">Interview</option>

                    <option value="Success">Success</option>

                </select>

            </div>



            <section class="table-container">

                <table class="job-table">

                    <thead><tr><th>Company</th><th>Role</th><th>Date</th><th>Rounds</th><th>Status</th><th>Action</th></tr></thead>

                    <tbody id="jobTableBody"></tbody>

                </table>

            </section>

        </div>



        
      <div id="tasks-section" class="content-section">
    <div style="display: flex; gap: 20px; margin-bottom: 20px;">

        <div style="flex: 1; background: #6a0dad; color: white; padding: 15px; border-radius: 12px; text-align: center; cursor: pointer;" onclick="generateDetailedReport()">

            <small>Weekly Efficiency</small>

            <h2 id="weekly-report-val">0%</h2>

            <span style="font-size: 11px;">Click for Full Report</span>

        </div>

        <div style="flex: 1; background: #27ae60; color: white; padding: 15px; border-radius: 12px; text-align: center;">

            <small>Monthly Progress</small>

            <h2 id="monthly-report-val">0%</h2>

            <span style="font-size: 11px;">Updated via Graph</span>

        </div>

    </div>



    
    <div class="habit-main-container" style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3>?? Monthly Habit Tracker (4 Weeks)</h3>
            <div id="evaluation-score" style="background: #6a0dad; color: white; padding: 10px 20px; border-radius: 20px; font-weight: bold;">Score: 0%</div>
        </div>

        <div style="display: flex; gap: 20px; overflow-x: auto; padding-bottom: 15px;">
            <div class="week-box" style="min-width: 300px; border: 2px solid #e8daef; border-radius: 12px; padding: 10px;">
                <h4 style="text-align: center; background: #e8daef; padding: 5px; border-radius: 8px;">WEEK 1</h4>
                <table style="width: 100%; text-align: center; font-size: 12px;">
                    <thead><tr><th>Habit</th><th>M</th><th>T</th><th>W</th><th>T</th><th>F</th><th>S</th><th>S</th></tr></thead>
                    <tbody id="week1Body"></tbody>
                </table>
            </div>

            <div class="week-box" style="min-width: 300px; border: 2px solid #d4efdf; border-radius: 12px; padding: 10px;">
                <h4 style="text-align: center; background: #d4efdf; padding: 5px; border-radius: 8px;">WEEK 2</h4>
                <table style="width: 100%; text-align: center; font-size: 12px;">
                    <thead><tr><th>Habit</th><th>M</th><th>T</th><th>W</th><th>T</th><th>F</th><th>S</th><th>S</th></tr></thead>
                    <tbody id="week2Body"></tbody>
                </table>
            </div>

            <div class="week-box" style="min-width: 300px; border: 2px solid #d6eaf8; border-radius: 12px; padding: 10px;">
                <h4 style="text-align: center; background: #d6eaf8; padding: 5px; border-radius: 8px;">WEEK 3</h4>
                <table style="width: 100%; text-align: center; font-size: 12px;">
                    <thead><tr><th>Habit</th><th>M</th><th>T</th><th>W</th><th>T</th><th>F</th><th>S</th><th>S</th></tr></thead>
                    <tbody id="week3Body"></tbody>
                </table>
            </div>

            <div class="week-box" style="min-width: 300px; border: 2px solid #fcf3cf; border-radius: 12px; padding: 10px;">
                <h4 style="text-align: center; background: #fcf3cf; padding: 5px; border-radius: 8px;">WEEK 4</h4>
                <table style="width: 100%; text-align: center; font-size: 12px;">
                    <thead><tr><th>Habit</th><th>M</th><th>T</th><th>W</th><th>T</th><th>F</th><th>S</th><th>S</th><th>Action</th> </tr>
                    
                    </thead>
                    <tbody id="week4Body"></tbody>
                </table>
            </div>
        </div>

        <div style="margin-top: 20px; display: flex; gap: 10px;">
            <input type="text" id="newHabitInput" placeholder="Add new habit..." style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
            <button class="add-btn" onclick="addNewHabitRow()">Add Habit</button>
            <button class="add-btn" style="background: #27ae60;" onclick="updateHabitProgress()">Update Progress</button>
        </div>
    </div>
</div>

       


    <div id="reportModal" class="modal-overlay">

        <div class="modal-content" style="background: white; padding: 30px; border-radius: 15px; width: 350px;">

            <h2 style="color: #6a0dad; margin-bottom: 15px;">Performance Report</h2>

            <div id="reportContent" style="background: #f9f9f9; padding: 15px; border-radius: 8px; margin-bottom: 20px; font-size: 14px; line-height: 1.6;">

                </div>

            <button onclick="document.getElementById('reportModal').style.display='none'" class="add-btn" style="width: 100%;">Close Report</button>

        </div>

    </div>

</div>



        <div id="analytics-section" class="content-section">

            <div style="display: flex; gap: 20px; margin-bottom: 25px;">

                <div style="flex: 1; background: #6a0dad; color: white; padding: 20px; border-radius: 15px; text-align: center;">

                    <h4>Weekly Evaluation</h4>

                    <h2 id="weekly-report-val">32%</h2>

                </div>

                <div style="flex: 1; background: #27ae60; color: white; padding: 20px; border-radius: 15px; text-align: center;">

                    <h4>Monthly Efficiency</h4>

                    <h2 id="monthly-report-val">14%</h2>

                </div>

            </div>

            <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); text-align: center;">

                <h3 style="color: #6a0dad; margin-bottom: 20px;">Performance Graph</h3>

                <canvas id="jobChart"></canvas>

            </div>

        </div>



        <div id="profile-section" class="content-section">

            <div class="profile-card" style="background: white; padding: 40px; border-radius: 20px; text-align: center; max-width: 500px; margin: 0 auto;">

                <div style="width: 80px; height: 80px; background: #6a0dad; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; margin: 0 auto 20px;"><i class="fas fa-user"></i></div>

                <h2 id="prof-display-name">User</h2>

                <p id="prof-display-email"></p>

                <button onclick="handleLogout(event)" style="background: #e74c3c; color: white; border: none; padding: 10px 20px; border-radius: 8px; margin-top: 20px; cursor: pointer;">Logout</button>

            </div>

        </div>

    </main>



    <div id="jobModal" class="modal-overlay">
    <div class="modal-content" style="background: white; padding: 30px; border-radius: 15px; width: 350px; display: flex; flex-direction: column; gap: 15px;">
        <h2>Add Job</h2>
        <input type="text" id="compName" placeholder="Company">
        <input type="text" id="roleName" placeholder="Role">
        <input type="date" id="applyDate">
        <input type="number" id="roundsAttended" placeholder="Rounds">
        <textarea id="jobDesc" placeholder="Enter Job Description..." style="padding: 10px; border-radius: 8px; border: 1px solid #ddd; height: 80px; font-family: inherit; resize: none;"></textarea>
        
       
        <select id="jobStat">
            <option value="Applied">Applied</option>
            <option value="Interview">Interview</option>
            <option value="Success">Success</option>
            <option value="Fail">Fail</option>
        </select>
        <button onclick="saveJobData()" class="add-btn">Save Job</button>
        <button onclick="closeModal()" style="background: #ccc; border: none; padding: 10px; border-radius: 8px; cursor: pointer;">Cancel</button>
    </div>
</div>

<div id="descModal" class="modal-overlay">
    <div class="modal-content" style="background: white; padding: 25px; border-radius: 15px; width: 320px; text-align: center; box-shadow: 0 5px 20px rgba(0,0,0,0.2);">
        <h3 style="color: #6a0dad; margin-bottom: 15px;">?? Job Description</h3>
        <hr style="border: 0; border-top: 1px solid #eee; margin-bottom: 15px;">
        
        <p id="descText" style="background: #f4f4f4; padding: 15px; border-radius: 8px; font-size: 14px; min-height: 80px; text-align: left; color: #333; line-height: 1.5;"></p>
        
        <button onclick="document.getElementById('descModal').style.display='none'" class="add-btn" style="width: 100%; margin-top: 15px; background: #6a0dad;">Close</button>
    </div>
</div>

   <script>
    const userEmail = localStorage.getItem("loggedInUser");
    let myChart;

    window.onload = function() {
        if (!userEmail) {
            window.location.href = "login.html";
        } else {
            const userName = userEmail.split('@')[0];
            if(document.getElementById('displayUserName')) document.getElementById('displayUserName').innerText = userName;
            if(document.getElementById('prof-display-name')) document.getElementById('prof-display-name').innerText = userName;
            if(document.getElementById('prof-display-email')) document.getElementById('prof-display-email').innerText = userEmail;

            loadUserJobs();    
            loadHabits();      
            initAnalytics();   
        }
    };

   // --- 1. JOB LOGIC (OVERVIEW) ---
    function loadUserJobs() {
        fetch(`http://localhost:8081/api/jobs/user/${userEmail}`)
            .then(res => res.json())
            .then(data => {
                const tableBody = document.getElementById('jobTableBody');
                tableBody.innerHTML = '';
                let counts = { applied: 0, interview: 0, success: 0 };

                data.forEach(job => {
                    let s = job.status.toLowerCase();
                    tableBody.innerHTML += `
                        <tr>
                            <td>${job.company}</td>
                            <td>${job.role}</td>
                            <td>${job.date}</td>
                            <td>${job.rounds || '1'}</td>
                            <td><span class="status-badge ${s}">${job.status}</span></td>
                            <td>
                                <button onclick="viewDescription('${job.description || ''}')" style="color:#6a0dad; border:none; background:none; cursor:pointer;"><i class="fas fa-eye"></i> View</button>
                                <button onclick="deleteJob('${job.id}')" style="color:red; border:none; background:none; cursor:pointer; margin-left:10px;"><i class="fas fa-trash"></i> Delete</button>
                            </td>
                        </tr>`;
                    if(counts.hasOwnProperty(s)) counts[s]++;
                });

                document.getElementById('totalCount').innerText = counts.applied;
                document.getElementById('interviewCount').innerText = counts.interview;
                document.getElementById('successCount').innerText = counts.success;
                
                // Dashboard logic sync
                updateJobAnalytics();
            }).catch(err => console.error("Error loading jobs:", err));
    }


    function saveJobData() {
    const jobObj = {
        company: document.getElementById('compName').value,
        role: document.getElementById('roleName').value,
        date: document.getElementById('applyDate').value,
        status: document.getElementById('jobStat').value,
        rounds: document.getElementById('roundsAttended').value,
        userEmail: userEmail
    };

    
    if(!jobObj.company || !jobObj.role) {
        alert("Company and Role kandippa venum!");
        return;
    }

    fetch('http://localhost:8081/api/jobs/add', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(jobObj)
    })
    .then(res => {
        if(res.ok) {
            alert("Job Saved! ðŸŽ‰");
            closeModal(); 
            
            
            loadUserJobs(); 
            
           
            document.getElementById('compName').value = '';
            document.getElementById('roleName').value = '';
        } else {
            alert("error!");
        }
    })
    .catch(err => console.error("Error saving job:", err));
}

   function deleteJob(id) {
    if (confirm("Delete this?")) {
        fetch(`http://localhost:8081/api/jobs/${id}`, {
            method: 'DELETE'
        })
        .then(res => {
            if (res.ok) {
                alert("Deleted! ðŸ—‘ï¸");
                
                loadUserJobs(); 
            } else {
                alert("not delete");
            }
        })
        .catch(err => console.error("Error:", err));
    }
}
    
 async function loadHabits() {
        try {
            const response = await fetch(`http://localhost:8081/api/habits/user/${userEmail}`);
            const savedHabits = await response.json();
            const defaultHabits = ["Wake up at 6AM â°", "No Snoozing ðŸš«", "Drink 3L Water ðŸ’§"];
            const dynamicHabitNames = [...new Set(savedHabits.map(h => h.habitName))];
            const allHabitNames = [...new Set([...defaultHabits, ...dynamicHabitNames])];

            for(let w=1; w<=4; w++) {
                const tbody = document.getElementById(`week${w}Body`);
                if(tbody) tbody.innerHTML = '';
            }

            allHabitNames.forEach(name => {
                for(let w = 1; w <= 4; w++) {
                    const tbody = document.getElementById(`week${w}Body`);
                    if(!tbody) continue;
                    let row = `<tr><td style="text-align:left; font-size:11px; white-space:nowrap; padding: 5px;">${name}</td>`;
                    for(let d = 0; d < 7; d++) {
                        const entry = savedHabits.find(h => h.habitName === name && h.weekNumber === w && h.dayIndex === d);
                        const isChecked = entry ? entry.status : false;
                        row += `<td><input type="checkbox" class="habit-check" ${isChecked ? 'checked' : ''} onchange="saveHabitToBackend('${name}', ${w}, ${d}, this.checked)"></td>`;
                    }
                    if(w === 4) row += `<td><button onclick="deleteHabitRow('${name}')" style="color:red; border:none; background:none; cursor:pointer;"><i class="fas fa-trash"></i></button></td>`;
                    row += `</tr>`;
                    tbody.innerHTML += row;
                }
            });
            calculateWeeklyScore();
        } catch (err) { console.error("Habit Load Error:", err); }
    }
                        

   
    function calculateWeeklyScore() {
    const checks = document.querySelectorAll('.habit-check');
    const checked = document.querySelectorAll('.habit-check:checked');
    
    // 1. Calculate Score
    const score = checks.length > 0 ? Math.round((checked.length / checks.length) * 100) : 0;
    
    // 2. Update the Habit Tracker Purple Box
    const evalScoreEl = document.getElementById('evaluation-score');
    if(evalScoreEl) evalScoreEl.innerText = `Habit Score: ${score}%`;

    
    document.querySelectorAll('#weekly-report-val').forEach(el => {
        el.innerText = score + "%";
    });

    document.querySelectorAll('#monthly-report-val').forEach(el => {
        
        el.innerText = Math.round(score * 0.8) + "%"; 
    });
}
        

        



        updateAnalyticsChart(score);

    


   async function deleteHabitRow(habitName) {
    if (confirm(`Delete "${habitName}"?`)) {
        try {
            const response = await fetch(`http://localhost:8081/api/habits/delete/${userEmail}/${habitName}`, {
                method: 'DELETE'
            });

            if (response.ok) {
                alert("Deleted! ðŸ—‘ï¸");
                await loadHabits(); 
            }
        } catch (err) {
            console.error("Delete Error:", err);
        }
    }
}



    async function addNewHabitRow() {
    const habitInput = document.getElementById('newHabitInput');
    const habitName = habitInput.value.trim();

    if (habitName === "") {
        alert("Habit type !");
        return;
    }

    const newHabitData = {
        habitName: habitName,
        weekNumber: 1, 
        dayIndex: 0,
        status: false,
        userEmail: userEmail
    };

    try {
        const response = await fetch('http://localhost:8081/api/habits/update', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(newHabitData)
        });

        if (response.ok) {
            alert("Habit Added! âœ…");
            habitInput.value = ''; 
            await loadHabits();   
        } else {
            alert("Error: Habit don't save !");
        }
    } catch (err) {
        console.error("Error:", err);
    }
}

    // --- 3. ANALYTICS (Fixed IDs) ---
    function initAnalytics() {
        const canvas = document.getElementById('jobChart');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        if (myChart) myChart.destroy();
        myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Applied', 'Interview', 'Success', 'Fail'],
                datasets: [{
                    label: 'Jobs Count',
                    data: [0, 0, 0, 0], 
                    backgroundColor: ['#9b59b6', '#3498db', '#27ae60', '#e74c3c']
                }]
            },
            options: { scales: { yAxes: [{ ticks: { beginAtZero: true, stepSize: 1 } }] } }
        });
        updateJobAnalytics();
    }

function updateJobAnalytics() {
        fetch(`http://localhost:8081/api/jobs/user/${userEmail}`)
            .then(res => res.json())
            .then(data => {
                const totalJobs = data.length; 
                let jobEfficiency = Math.round((totalJobs / 30) * 100); // Target 30
                let monthlyProgress = Math.round((totalJobs / 100) * 100); // Target 100

                // Update ALL occurrences of these IDs
                document.querySelectorAll('#weekly-report-val').forEach(el => {
                    el.innerText = (jobEfficiency > 100 ? 100 : jobEfficiency) + "%";
                });
                document.querySelectorAll('#monthly-report-val').forEach(el => {
                    el.innerText = (monthlyProgress > 100 ? 100 : monthlyProgress) + "%";
                });

                let counts = { applied: 0, interview: 0, success: 0, fail: 0 };
                data.forEach(job => {
                    let s = job.status.toLowerCase();
                    if (counts.hasOwnProperty(s)) counts[s]++;
                });

                if (myChart) {
                    myChart.data.datasets[0].data = [counts.applied, counts.interview, counts.success, counts.fail];
                    myChart.update();
                }
            });
    }


     

    function generateDetailedReport() {

        const score = document.getElementById('weekly-report-val').innerText;

        const reportContent = document.getElementById('reportContent');

        let status = parseInt(score) >= 70 ? "Excellent Consistency! ??" : "Keep pushing, consistency is key! ??";



        reportContent.innerHTML = `

            <p><b>Weekly Completion:</b> ${score}</p>

            <p><b>Status:</b> ${status}</p>

            <hr style="border:0; border-top:1px solid #eee; margin:10px 0;">

            <p style="font-size:11px; color:#666;">Report generated on: ${new Date().toLocaleDateString()}</p>

        `;

        document.getElementById('reportModal').style.display = 'flex';

    }

    function updateEfficiencyCards(allJobs) {
    const totalJobs = allJobs.length;
    if (totalJobs === 0) return;

    
    const successJobs = allJobs.filter(job => job.status.toLowerCase() === 'success').length;
    const weeklyRate = Math.round((successJobs / totalJobs) * 100);
    
    const weeklyEl = document.getElementById('weekly-report-val');
    if(weeklyEl) weeklyEl.innerText = weeklyRate + "%";

    
    const monthlyTarget = 10; 
    const monthlyRate = Math.min(Math.round((totalJobs / monthlyTarget) * 100), 100);
    
    const monthlyEl = document.getElementById('monthly-report-val');
    if(monthlyEl) monthlyEl.innerText = monthlyRate + "%";
}



    // --- 4. NAVIGATION & UI HELPERS ---

   
    function showSection(section) {
    document.querySelectorAll('.content-section').forEach(s => s.style.display = 'none');
    document.getElementById(section + '-section').style.display = 'block';

    
    if (section === 'analytics') {
        updateJobAnalytics(); 
    }
}



    // --- Modal & Helpers ---
    function openModal() { document.getElementById('jobModal').style.display = 'flex'; }
    function closeModal() { document.getElementById('jobModal').style.display = 'none'; }
    function showSection(section) {
        document.querySelectorAll('.content-section').forEach(s => s.style.display = 'none');
        document.getElementById(section + '-section').style.display = 'block';
        if (section === 'analytics') updateJobAnalytics();
    }
    

    function filterJobs() {

        let search = document.getElementById('searchInput').value.toLowerCase();

        let filter = document.getElementById('statusFilter').value.toLowerCase();

        document.querySelectorAll('#jobTableBody tr').forEach(row => {

            let text = row.innerText.toLowerCase();

            let status = row.querySelector('.status-badge').innerText.toLowerCase();

            row.style.display = (text.includes(search) && (filter === 'all' || status === filter)) ? '' : 'none';

        });

    }



    function handleLogout(e) { 

        e.preventDefault(); 

        localStorage.removeItem("loggedInUser"); 

        window.location.href = "login.html"; 

    }

    function exportToCSV() {

    
    const rows = document.querySelectorAll("#jobTableBody tr");

    

    if (rows.length === 0) {

        alert("Export data no ?");

        return;

    }



    // CSV Header

    let csvContent = "Company,Role,Applied Date,Rounds,Status\n";



    rows.forEach(row => {

       
        const cols = row.querySelectorAll("td");

        

       
        const company = cols[0].innerText.trim();

        const role = cols[1].innerText.trim();

        const date = cols[2].innerText.trim();

        const rounds = cols[3].innerText.trim();

        

        

        const status = cols[4].querySelector('.status-badge').innerText.trim();



        // Row-ah CSV format-la mathuroom (Commas handle panna quotes use panrom)

        csvContent += `"${company}","${role}","${date}","${rounds}","${status}"\n`;

    });



    // File download logic

    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });

    const url = window.URL.createObjectURL(blob);

    const link = document.createElement("a");

    link.setAttribute("href", url);

    link.setAttribute("download", `My_Job_Applications_${new Date().toLocaleDateString()}.csv`);

    

    document.body.appendChild(link);

    link.click();

    document.body.removeChild(link);

}  

function updateWeeklyAnalytics(jobs) {
    if(!myChart) return;

    
    let weekCounts = [0, 0, 0, 0]; // Week 1, 2, 3, 4
    
    jobs.forEach(job => {
        let jobDate = new Date(job.date);
        let day = jobDate.getDate();
        
        // Simple week calculation based on date
        if (day <= 7) weekCounts[0]++;
        else if (day <= 14) weekCounts[1]++;
        else if (day <= 21) weekCounts[2]++;
        else weekCounts[3]++;
    });

    myChart.data.datasets[0].data = weekCounts;
    myChart.update();
}

function viewDescription(desc) {
    
    const cleanDesc = (desc && desc !== "undefined" && desc !== "") ? desc : "No description provided for this job.";
    
    
    document.getElementById('descText').innerText = cleanDesc;
    
   
    document.getElementById('descModal').style.display = 'flex';
}

function saveHabitToBackend(name, week, day, isChecked) {
        const habitData = { habitName: name, weekNumber: week, dayIndex: day, status: isChecked, userEmail: userEmail };
        fetch('http://localhost:8081/api/habits/update', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(habitData)
        }).then(res => { if(res.ok) calculateWeeklyScore(); });
    }

function updateHabitProgress() {
    calculateWeeklyScore();
    loadHabits(); 
    alert("Progress Synced with Database! âœ…");
}
</script>
</body>
</html>